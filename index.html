
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <title>Th·ª≠ T√†i VƒÉn H·ªçc - Roboki AI</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700;900&family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    
    <style>
      body { font-family: 'Be Vietnam Pro', sans-serif; -webkit-tap-highlight-color: transparent; }
      h1, h2, h3, .serif-font { font-family: 'Merriweather', serif; }
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: #f1f1f1; }
      ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
      
      /* Background Styles */
      .bg-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1; background-color: #fdfbf7; background-image: url("https://www.transparenttextures.com/patterns/cream-paper.png"); overflow: hidden; }
      .wash { position: absolute; filter: blur(80px); opacity: 0.4; border-radius: 50%; animation: float 20s infinite ease-in-out alternate; }
      .wash-1 { top: -10%; left: -10%; width: 70vw; height: 70vw; background: radial-gradient(circle, #e0f2fe, #fdfbf7); animation-duration: 25s; }
      .wash-2 { bottom: -20%; right: -10%; width: 60vw; height: 60vw; background: radial-gradient(circle, #fae8ff, #fdfbf7); animation-duration: 30s; animation-direction: alternate-reverse; }
      .wash-3 { top: 40%; left: 30%; width: 50vw; height: 50vw; background: radial-gradient(circle, #fff7ed, #fdfbf7); animation-duration: 35s; }
      @keyframes float { 0% { transform: translate(0, 0) rotate(0deg); } 100% { transform: translate(30px, 20px) rotate(5deg); } }
      .glass-panel { background: rgba(255, 255, 255, 0.65); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.6); }
      .custom-scrollbar::-webkit-scrollbar { width: 4px; }
      .custom-scrollbar::-webkit-scrollbar-thumb { background-color: rgba(0,0,0,0.1); border-radius: 10px; }
      @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
      .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
      @keyframes scale-in { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
      .animate-scale-in { animation: scale-in 0.4s ease-out forwards; }
      @keyframes slide-up { from { transform: translateY(100%); } to { transform: translateY(0); } }
      .animate-slide-up { animation: slide-up 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
      @keyframes bounce-slow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
      .animate-bounce-slow { animation: bounce-slow 3s infinite ease-in-out; }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden text-slate-800 antialiased selection:bg-amber-200 selection:text-amber-900">
    <div class="bg-container">
        <div class="wash wash-1"></div>
        <div class="wash wash-2"></div>
        <div class="wash wash-3"></div>
    </div>
    <div id="root" class="h-full w-full relative z-10"></div>

    <script type="text/babel">
        // --- CONSTANTS & DATA POOL ---
        const ROBOKI_LOGO_URL = "https://github.com/bichhai85-lab/Roboki/blob/main/bi%E1%BB%83u%20t%C6%B0%E1%BB%A3ng%20roboki.jpg?raw=true";
        
        const SOUNDS = {
            CORRECT: "https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3", 
            CORRECT_LAYER: "https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3",
            WRONG: "https://assets.mixkit.co/active_storage/sfx/2834/2834-preview.mp3",
            WRONG_LAYER: "https://assets.mixkit.co/active_storage/sfx/2572/2572-preview.mp3",
            VICTORY_LEVEL: "https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3",
            CERTIFICATE_SOUND: "https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3",
            BGM_EPIC: "https://assets.mixkit.co/active_storage/sfx/1004/1004-preview.mp3"
        };

        const LevelType = {
            LEVEL_1: 'LEVEL_1',
            LEVEL_2: 'LEVEL_2',
            LEVEL_3: 'LEVEL_3',
            SPECIAL: 'SPECIAL',
            GRADUATION: 'GRADUATION'
        };

        const CertificateRank = {
            DAT: 'ƒê·∫†T',
            KHA: 'KH√Å',
            GIOI: 'GI·ªéI',
            XUAT_SAC: 'XU·∫§T S·∫ÆC',
            NHAN_TAI: 'NH√ÇN T√ÄI VƒÇN H·ªåC',
            THIEN_TAI: 'THI√äN T√ÄI VƒÇN H·ªåC'
        };

        const LEVEL_INFO = {
            [LevelType.LEVEL_1]: { title: "LEVEL 1: TH·ª¨ T√ÄI KH√ÅI NI·ªÜM", desc: "Ki·ªÉm tra ki·∫øn th·ª©c v·ªÅ c√°c kh√°i ni·ªám c∆° b·∫£n c·ªßa th∆° nh∆∞ V·∫ßn, T·ª© th∆°, Ch·ªß ƒë·ªÅ...", passScore: 5, icon: "üìñ" },
            [LevelType.LEVEL_2]: { title: "LEVEL 2: TH·ª¨ T√ÄI PH√ÇN BI·ªÜT", desc: "Ph√¢n bi·ªát c√°c c·∫∑p kh√°i ni·ªám d·ªÖ nh·∫ßm l·∫´n nh∆∞ H√¨nh t∆∞·ª£ng/H√¨nh ·∫£nh...", passScore: 5, icon: "‚öñÔ∏è" },
            [LevelType.LEVEL_3]: { title: "LEVEL 3: TH·ª¨ T√ÄI V·∫¨N D·ª§NG", desc: "V·∫≠n d·ª•ng ki·∫øn th·ª©c v√†o c√°c ƒëo·∫°n th∆° c·ª• th·ªÉ.", passScore: 5, icon: "‚úçÔ∏è" },
            [LevelType.SPECIAL]: { title: "TH·ª¨ TH√ÅCH ƒê·∫∂C BI·ªÜT", desc: "V√≤ng thi d√†nh cho Nh√¢n t√†i. Ph√¢n t√≠ch s√¢u s·∫Øc ngh·ªá thu·∫≠t.", passScore: 5, icon: "üî•" },
            [LevelType.GRADUATION]: { title: "V√íNG ƒê·ªàNH CAO TR√ç TU·ªÜ", desc: "Th·ª≠ th√°ch cu·ªëi c√πng d√†nh cho Thi√™n t√†i vƒÉn h·ªçc.", passScore: 5, icon: "üéì" }
        };

        // LARGE QUESTION POOL FOR RANDOMIZATION
        // M·ªói l·∫ßn ch∆°i s·∫Ω b·ªëc ng·∫´u nhi√™n 5 c√¢u t·ª´ danh s√°ch n√†y
        const QUESTION_POOL = {
            [LevelType.LEVEL_1]: [
                {content: "\"V·∫ßn\" trong th∆° c√≥ vai tr√≤ ch√≠nh l√† g√¨?", options: ["T·∫°o nh·∫°c ƒëi·ªáu, li√™n k·∫øt", "M√¥ t·∫£ h√†nh ƒë·ªông", "ƒê·∫øm s·ªë t·ª´", "Ti√™u ƒë·ªÅ b√†i th∆°"], correctIndex: 0, explanation: "V·∫ßn t·∫°o t√≠nh nh·∫°c v√† s·ª± li√™n k·∫øt."},
                {content: "\"T·ª© th∆°\" ƒë∆∞·ª£c hi·ªÉu l√† g√¨?", options: ["S·ªë c√¢u", "√ù t∆∞·ªüng ngh·ªá thu·∫≠t bao tr√πm", "C√°ch gieo v·∫ßn", "C·∫•u tr√∫c kh·ªï"], correctIndex: 1, explanation: "T·ª© th∆° l√† x∆∞∆°ng s·ªëng chi ph·ªëi to√†n b√†i."},
                {content: "\"Ch·ªß ƒë·ªÅ\" c·ªßa t√°c ph·∫©m l√†?", options: ["T√™n t√°c gi·∫£", "V·∫•n ƒë·ªÅ trung t√¢m", "Ho√†n c·∫£nh s√°ng t√°c", "NƒÉm xu·∫•t b·∫£n"], correctIndex: 1, explanation: "Ch·ªß ƒë·ªÅ l√† v·∫•n ƒë·ªÅ c·ªët l√µi t√°c gi·∫£ ƒë·∫∑t ra."},
                {content: "\"Bi·ªán ph√°p tu t·ª´\" l√† g√¨?", options: ["L·ªói ng·ªØ ph√°p", "C√°ch d√πng t·ª´ ngh·ªá thu·∫≠t", "T·ª´ l√°y", "Ch·∫•m c√¢u"], correctIndex: 1, explanation: "TƒÉng s·ª©c g·ª£i h√¨nh, g·ª£i c·∫£m."},
                {content: "\"Nh√¢n v·∫≠t tr·ªØ t√¨nh\" l√† ai?", options: ["Ng∆∞·ªùi ƒë·ªçc", "Ng∆∞·ªùi ƒë∆∞·ª£c k·ªÉ", "Ch·ªß th·ªÉ b·ªôc l·ªô c·∫£m x√∫c", "Nh√† ph√™ b√¨nh"], correctIndex: 2, explanation: "Ng∆∞·ªùi tr·ª±c ti·∫øp b·ªôc l·ªô c·∫£m x√∫c (c√°i t√¥i)."},
                {content: "\"Nh·ªãp th∆°\" c√≥ ch·ª©c nƒÉng g√¨?", options: ["Ng·∫Øt d√≤ng th∆°", "T·∫°o ti·∫øt t·∫•u, nh·∫°c ƒëi·ªáu", "Quy ƒë·ªãnh s·ªë ch·ªØ", "ƒê·∫∑t t√™n b√†i th∆°"], correctIndex: 1, explanation: "Nh·ªãp ƒëi·ªáu t·∫°o n√™n √¢m h∆∞·ªüng ƒë·∫∑c tr∆∞ng cho th∆°."},
                {content: "\"Th·ªÉ th∆°\" ƒë∆∞·ª£c x√°c ƒë·ªãnh d·ª±a tr√™n y·∫øu t·ªë n√†o?", options: ["S·ªë l∆∞·ª£ng c√¢u ch·ªØ, lu·∫≠t b·∫±ng tr·∫Øc", "N·ªôi dung b√†i th∆°", "T√™n t√°c gi·∫£", "NƒÉm s√°ng t√°c"], correctIndex: 0, explanation: "Th·ªÉ th∆° d·ª±a tr√™n quy lu·∫≠t v·ªÅ s·ªë c√¢u, s·ªë ti·∫øng, v·∫ßn, nh·ªãp."},
                {content: "Kh√°i ni·ªám \"Thi li·ªáu\" l√† g√¨?", options: ["Gi·∫•y vi·∫øt th∆°", "Ch·∫•t li·ªáu ƒë·ªùi s·ªëng ƒë∆∞a v√†o th∆°", "B√∫t vi·∫øt th∆°", "S√°ch in th∆°"], correctIndex: 1, explanation: "Thi li·ªáu l√† nh·ªØng h√¨nh ·∫£nh, s·ª± vi·ªác th·ª±c t·∫ø ƒë∆∞·ª£c ngh·ªá thu·∫≠t h√≥a."},
                {content: "\"C·∫•u t·ª©\" trong th∆° l√† g√¨?", options: ["S·∫Øp x·∫øp t·ªï ch·ª©c h√¨nh t∆∞·ª£ng", "S·ªë l∆∞·ª£ng t·ª´", "C√°ch ƒë·ªçc th∆°", "Trang tr√≠ b√†i th∆°"], correctIndex: 0, explanation: "C·∫•u t·ª© l√† s·ª± t·ªï ch·ª©c, s·∫Øp x·∫øp c√°c y·∫øu t·ªë ƒë·ªÉ th·ªÉ hi·ªán t·ª© th∆°."},
                {content: "\"Ng√¥n ng·ªØ th∆°\" c√≥ ƒë·∫∑c ƒëi·ªÉm g√¨ n·ªïi b·∫≠t?", options: ["D√†i d√≤ng, chi ti·∫øt", "C√¥ ƒë·ªçng, h√†m s√∫c, gi√†u h√¨nh ·∫£nh", "Gi·ªëng vƒÉn n√≥i h√†ng ng√†y", "Ch·ªâ d√πng t·ª´ H√°n Vi·ªát"], correctIndex: 1, explanation: "Ng√¥n ng·ªØ th∆° c·∫ßn s·ª± ch·∫Øt l·ªçc, ƒëa nghƒ©a v√† gi√†u t√≠nh nh·∫°c."}
            ],
            [LevelType.LEVEL_2]: [
                {content: "Kh√°c bi·ªát gi·ªØa \"H√¨nh t∆∞·ª£ng\" v√† \"H√¨nh ·∫£nh\"?", options: ["H√¨nh t∆∞·ª£ng kh√°i qu√°t h∆°n", "H√¨nh ·∫£nh l·ªõn h∆°n", "Gi·ªëng nhau", "H√¨nh ·∫£nh ch·ªâ c√≥ ·ªü vƒÉn xu√¥i"], correctIndex: 0, explanation: "H√¨nh t∆∞·ª£ng ƒë∆∞·ª£c x√¢y d·ª±ng t·ª´ h·ªá th·ªëng c√°c h√¨nh ·∫£nh."},
                {content: "Ph√¢n bi·ªát \"ƒê·ªÅ t√†i\" v√† \"Ch·ªß ƒë·ªÅ\"?", options: ["ƒê·ªÅ t√†i l√† c·ªët l√µi", "ƒê·ªÅ t√†i l√† ph·∫°m vi hi·ªán th·ª±c, Ch·ªß ƒë·ªÅ l√† t∆∞ t∆∞·ªüng", "L√† t√™n t√°c ph·∫©m", "ƒê·ªÅ t√†i nh·ªè h∆°n"], correctIndex: 1, explanation: "ƒê·ªÅ t√†i: vi·∫øt v·ªÅ c√°i g√¨. Ch·ªß ƒë·ªÅ: v·∫•n ƒë·ªÅ g√¨."},
                {content: "Kh√°c bi·ªát \"C·∫£m h·ª©ng ch·ªß ƒë·∫°o\" v√† \"T∆∞ t∆∞·ªüng\"?", options: ["Kh√¥ng kh√°c", "C·∫£m h·ª©ng l√† t√¨nh c·∫£m bao tr√πm; T∆∞ t∆∞·ªüng l√† nh·∫≠n th·ª©c", "T∆∞ t∆∞·ªüng ·ªü k·∫øt b√†i", "C·∫£m h·ª©ng ch·ªâ cho th∆° t√¨nh"], correctIndex: 1, explanation: "C·∫£m h·ª©ng thi√™n v·ªÅ c·∫£m x√∫c, T∆∞ t∆∞·ªüng thi√™n v·ªÅ l√Ω tr√≠."},
                {content: "Quan h·ªá \"Nh√¢n v·∫≠t tr·ªØ t√¨nh\" v√† \"T√°c gi·∫£\"?", options: ["L√† m·ªôt", "Nh√¢n v·∫≠t tr·ªØ t√¨nh l√† h√≥a th√¢n ngh·ªá thu·∫≠t", "T√°c gi·∫£ ƒë·ª©ng ngo√†i", "L√† ƒë·ªôc gi·∫£"], correctIndex: 1, explanation: "C√°i t√¥i trong th∆° kh√¥ng ho√†n to√†n l√† t√°c gi·∫£ ngo√†i ƒë·ªùi."},
                {content: "Ph√¢n bi·ªát \"·∫®n d·ª•\" v√† \"Ho√°n d·ª•\"?", options: ["·∫®n d·ª•: t∆∞∆°ng ƒë·ªìng; Ho√°n d·ª•: t∆∞∆°ng c·∫≠n", "·∫®n d·ª•: t∆∞∆°ng c·∫≠n", "·∫®n d·ª• d√πng 'nh∆∞'", "Kh√¥ng quy lu·∫≠t"], correctIndex: 0, explanation: "·∫®n d·ª• d·ª±a tr√™n n√©t gi·ªëng nhau, Ho√°n d·ª• d·ª±a tr√™n s·ª± ƒëi ƒë√¥i."},
                {content: "Ph√¢n bi·ªát \"ƒêi·ªáp ng·ªØ\" v√† \"ƒêi·ªáp c·∫•u tr√∫c\"?", options: ["ƒêi·ªáp ng·ªØ l·∫∑p t·ª´, ƒêi·ªáp c·∫•u tr√∫c l·∫∑p m·∫´u c√¢u", "Gi·ªëng h·ªát nhau", "ƒêi·ªáp ng·ªØ l·∫∑p c·∫£ c√¢u", "ƒêi·ªáp c·∫•u tr√∫c l·∫∑p √¢m"], correctIndex: 0, explanation: "ƒêi·ªáp ng·ªØ l·∫∑p l·∫°i t·ª´ ng·ªØ, ƒëi·ªáp c·∫•u tr√∫c l·∫∑p l·∫°i ki·ªÉu c√¢u."},
                {content: "S·ª± kh√°c nhau gi·ªØa \"So s√°nh\" v√† \"·∫®n d·ª•\"?", options: ["·∫®n d·ª• l√† so s√°nh ng·∫ßm (·∫©n v·∫ø A)", "So s√°nh kh√¥ng c√≥ t·ª´ 'nh∆∞'", "·∫®n d·ª• lu√¥n c√≥ t·ª´ 'nh∆∞'", "So s√°nh kh√≥ h∆°n"], correctIndex: 0, explanation: "So s√°nh ƒë·ªëi chi·∫øu A v·ªõi B. ·∫®n d·ª• che ƒëi A, ch·ªâ c√≤n B (quy chi·∫øu)."},
                {content: "Ph√¢n bi·ªát \"T·∫£ th·ª±c\" v√† \"L√£ng m·∫°n\"?", options: ["T·∫£ th·ª±c b√°m s√°t hi·ªán th·ª±c; L√£ng m·∫°n bay b·ªïng, l√Ω t∆∞·ªüng h√≥a", "T·∫£ th·ª±c d√πng nhi·ªÅu t√≠nh t·ª´", "L√£ng m·∫°n kh√¥ng c√≥ th·∫≠t", "T·∫£ th·ª±c ch·ªâ vi·∫øt v·ªÅ chi·∫øn tranh"], correctIndex: 0, explanation: "L√£ng m·∫°n th∆∞·ªùng t√¥ ƒë·∫≠m v·∫ª ƒë·∫πp phi th∆∞·ªùng, v∆∞·ª£t l√™n hi·ªán th·ª±c."},
                {content: "Kh√°c bi·ªát gi·ªØa \"Nh·ªãp ch·∫µn\" v√† \"Nh·ªãp l·∫ª\"?", options: ["T·∫°o c·∫£m gi√°c √™m ƒë·ªÅm vs tr√∫c tr·∫Øc", "Kh√¥ng ·∫£nh h∆∞·ªüng", "Nh·ªãp l·∫ª bu·ªìn h∆°n", "Nh·ªãp ch·∫µn vui h∆°n"], correctIndex: 0, explanation: "Nh·ªãp ch·∫µn th∆∞·ªùng t·∫°o s·ª± c√¢n ƒë·ªëi, h√†i h√≤a; nh·ªãp l·∫ª t·∫°o s·ª± bi·∫øn ƒë·ªïi, d·ªìn d·∫≠p."},
                {content: "Ph√¢n bi·ªát \"Kh√¥ng gian ngh·ªá thu·∫≠t\" v√† \"ƒê·ªãa ƒëi·ªÉm th·ª±c t·∫ø\"?", options: ["Kh√¥ng gian ngh·ªá thu·∫≠t mang t√≠nh quan ni·ªám, c·∫£m x√∫c", "ƒê·ªãa ƒëi·ªÉm th·ª±c t·∫ø ƒë·∫πp h∆°n", "Kh√¥ng gian ngh·ªá thu·∫≠t ph·∫£i r·ªông l·ªõn", "Gi·ªëng h·ªát nhau"], correctIndex: 0, explanation: "Kh√¥ng gian ngh·ªá thu·∫≠t l√† m√¥i tr∆∞·ªùng ho·∫°t ƒë·ªông c·ªßa nh√¢n v·∫≠t do t√°c gi·∫£ s√°ng t·∫°o."}
            ],
            [LevelType.LEVEL_3]: [
                {content: "Trong \"Sang Thu\", t·ª´ l√°y \"ch√πng ch√¨nh\" g·ª£i t·∫£ ƒëi·ªÅu g√¨?", options: ["S∆∞∆°ng d√†y", "S∆∞∆°ng ng·∫≠p ng·ª´ng, c√≥ t√¢m h·ªìn", "S∆∞∆°ng tan nhanh", "V√¥ nghƒ©a"], correctIndex: 1, explanation: "Nh√¢n h√≥a l√†n s∆∞∆°ng nh∆∞ l∆∞u luy·∫øn m√πa h·∫°.", citation: "Sang Thu - H·ªØu Th·ªânh"},
                {content: "\"M·∫∑t tr·ªùi xu·ªëng bi·ªÉn nh∆∞ h√≤n l·ª≠a\" d√πng bi·ªán ph√°p g√¨?", options: ["Nh√¢n h√≥a", "So s√°nh", "Ho√°n d·ª•", "·∫®n d·ª•"], correctIndex: 1, explanation: "So s√°nh c·ª±c t·∫£ v·∫ª ƒë·∫πp r·ª±c r·ª° ho√†ng h√¥n.", citation: "ƒêo√†n thuy·ªÅn ƒë√°nh c√°"},
                {content: "\"L√†n thu th·ªßy n√©t xu√¢n s∆°n\" kh·∫Øc h·ªça v·∫ª ƒë·∫πp n√†o?", options: ["Ph√∫c h·∫≠u", "S·∫Øc s·∫£o, tuy·ªát m·ªπ", "Gi·∫£n d·ªã", "Kh·ªèe kho·∫Øn"], correctIndex: 1, explanation: "V·∫ª ƒë·∫πp s·∫Øc s·∫£o khi·∫øn thi√™n nhi√™n ƒë·ªë k·ªµ.", citation: "Truy·ªán Ki·ªÅu"},
                {content: "\"B·∫øp l·ª≠a ·∫•p iu n·ªìng ƒë∆∞·ª£m\" g·ª£i c·∫£m gi√°c g√¨?", options: ["L·∫°nh l·∫Ωo", "S·ª£ h√£i", "·∫§m √°p, y√™u th∆∞∆°ng", "Ng·ªôt ng·∫°t"], correctIndex: 2, explanation: "G·ª£i t√¨nh b√† ch√°u ·∫•m √°p.", citation: "B·∫øp l·ª≠a"},
                {content: "\"Chi·∫øc khƒÉn\" trong ƒê·∫•t N∆∞·ªõc l·∫•y √Ω t·ª´ ƒë√¢u?", options: ["Truy·ªÅn thuy·∫øt", "Ca dao th∆∞∆°ng nh·ªõ", "S·ª≠ thi", "C·ªï t√≠ch"], correctIndex: 1, explanation: "Ca dao: KhƒÉn th∆∞∆°ng nh·ªõ ai...", citation: "ƒê·∫•t N∆∞·ªõc"},
                {content: "\"S√¥ng kh√¥ng hi·ªÉu n·ªïi m√¨nh / S√≥ng t√¨m ra t·∫≠n b·ªÉ\" th·ªÉ hi·ªán ƒëi·ªÅu g√¨?", options: ["S·ª± l·∫°c l√µng", "Kh√°t v·ªçng v∆∞∆°n t·ªõi c√°i l·ªõn lao", "S·ª£ h√£i", "Th√≠ch ƒëi ch∆°i"], correctIndex: 1, explanation: "Kh√°t v·ªçng t√¨m ki·∫øm t√¨nh y√™u ƒë√≠ch th·ª±c, r·ªông l·ªõn.", citation: "S√≥ng - Xu√¢n Qu·ª≥nh"},
                {content: "\"V∆∞·ªùn ai m∆∞·ªõt qu√° xanh nh∆∞ ng·ªçc\" (ƒê√¢y th√¥n Vƒ© D·∫°) g·ª£i t·∫£?", options: ["V·∫ª ƒë·∫πp t∆∞∆°i non, trong tr·∫ªo", "V·∫ª ƒë·∫πp sang tr·ªçng", "R·ª´ng n√∫i r·∫≠m r·∫°p", "M√†u xanh nh√¢n t·∫°o"], correctIndex: 0, explanation: "G·ª£i v·∫ª ƒë·∫πp trinh nguy√™n, tr√†n ƒë·∫ßy s·ª©c s·ªëng c·ªßa th√¥n Vƒ©.", citation: "ƒê√¢y th√¥n Vƒ© D·∫°"},
                {content: "\"ƒê·∫•t N∆∞·ªõc l√† m√°u x∆∞∆°ng c·ªßa m√¨nh\" s·ª≠ d·ª•ng bi·ªán ph√°p?", options: ["So s√°nh", "·∫®n d·ª• ƒë·ªãnh nghƒ©a", "Nh√¢n h√≥a", "Li·ªát k√™"], correctIndex: 1, explanation: "Kh·∫≥ng ƒë·ªãnh s·ª± g·∫Øn b√≥ ru·ªôt th·ªãt gi·ªØa c√° nh√¢n v√† ƒê·∫•t N∆∞·ªõc.", citation: "ƒê·∫•t N∆∞·ªõc"},
                {content: "\"C·ªßi m·ªôt c√†nh kh√¥ l·∫°c m·∫•y d√≤ng\" (Tr√†ng Giang) g·ª£i c·∫£m gi√°c?", options: ["Nh·ªè b√©, tr√¥i n·ªïi, v√¥ ƒë·ªãnh", "M·∫°nh m·∫Ω, ki√™n c∆∞·ªùng", "Vui t∆∞∆°i", "ƒê√¥ng ƒë√∫c"], correctIndex: 0, explanation: "G·ª£i ki·∫øp ng∆∞·ªùi nh·ªè b√© gi·ªØa d√≤ng ƒë·ªùi m√™nh m√¥ng.", citation: "Tr√†ng Giang"},
                {content: "\"Qu√¢n xanh m√†u l√° d·ªØ oai h√πm\" (T√¢y Ti·∫øn) mi√™u t·∫£?", options: ["Qu√¢n ph·ª•c ng·ª•y trang", "V·∫ª xanh xao v√¨ b·ªánh nh∆∞ng v·∫´n oai phong", "Qu√¢n ƒë·ªôi y·∫øu ·ªõt", "M√†u s·∫Øc r·ª´ng n√∫i"], correctIndex: 1, explanation: "T·∫£ th·ª±c b·ªánh s·ªët r√©t nh∆∞ng d√πng t·ª´ H√°n Vi·ªát ƒë·ªÉ t√¥ ƒë·∫≠m kh√≠ ph√°ch.", citation: "T√¢y Ti·∫øn"}
            ],
            [LevelType.SPECIAL]: [
                 {content: "\"T√¢y Ti·∫øn ƒëo√†n binh kh√¥ng m·ªçc t√≥c\" d√πng b√∫t ph√°p g√¨?", options: ["T·∫£ th·ª±c", "L√£ng m·∫°n bi tr√°ng", "Tr√†o ph√∫ng", "Si√™u th·ª±c"], correctIndex: 1, explanation: "V·∫ª ƒë·∫πp phi th∆∞·ªùng, d·ªØ d·ªôi c·ªßa ng∆∞·ªùi l√≠nh.", citation: "T√¢y Ti·∫øn"},
                 {content: "\"M√πa ch∆∞a ng·∫£ chi·ªÅu h√¥m\" (V·ªôi v√†ng) th·ªÉ hi·ªán quan ni·ªám?", options: ["S·ªëng ch·∫≠m", "Tu h√†nh", "S·ªëng g·∫•p g√°p, t·∫≠n h∆∞·ªüng", "Hy sinh"], correctIndex: 2, explanation: "Ch·∫°y ƒëua v·ªõi th·ªùi gian, s·ªëng tr·ªçn v·∫πn tu·ªïi tr·∫ª.", citation: "V·ªôi v√†ng"},
                 {content: "C·∫•u tr√∫c h√¨nh t∆∞·ª£ng \"S√≥ng\" v√† \"Em\" c√≥ ƒë·∫∑c ƒëi·ªÉm g√¨?", options: ["ƒê∆°n l·∫ª", "Song h√†nh, t∆∞∆°ng ƒë·ªìng", "ƒê·ªëi l·∫≠p", "Ph·∫£n di·ªán"], correctIndex: 1, explanation: "Tuy hai m√† m·ªôt, soi chi·∫øu l·∫´n nhau.", citation: "S√≥ng"},
                 {content: "Kh·ªï ƒë·∫ßu \"ƒê√¢y th√¥n Vƒ© D·∫°\" g·ª£i khung c·∫£nh n√†o?", options: ["U √°m", "T∆∞∆°i s√°ng, t√¨nh t·ª©", "H√πng vƒ©", "Hoang t√†n"], correctIndex: 1, explanation: "C·∫£nh ban mai th√¥n Vƒ© ƒë·∫πp nh∆∞ tranh.", citation: "ƒê√¢y th√¥n Vƒ© D·∫°"},
                 {content: "\"√Ånh trƒÉng im phƒÉng ph·∫Øc\" g·ª£i ƒëi·ªÅu g√¨?", options: ["TrƒÉng t·ªëi", "Nghi√™m kh·∫Øc", "Nh√¢n ch·ª©ng nghƒ©a t√¨nh, nghi√™m kh·∫Øc", "TrƒÉng l·∫∑n"], correctIndex: 2, explanation: "S·ª± th·ª©c t·ªânh l∆∞∆°ng t√¢m con ng∆∞·ªùi.", citation: "√Ånh trƒÉng"},
                 {content: "\"S√≥ng ƒë√£ c√†i then, ƒë√™m s·∫≠p c·ª≠a\" d√πng bi·ªán ph√°p?", options: ["Nh√¢n h√≥a", "So s√°nh", "Ho√°n d·ª•", "·∫®n d·ª•"], correctIndex: 0, explanation: "V≈© tr·ª• nh∆∞ ng√¥i nh√† l·ªõn ƒëi v√†o tr·∫°ng th√°i ngh·ªâ ng∆°i.", citation: "ƒêo√†n thuy·ªÅn ƒë√°nh c√°"},
                 {content: "\"Hoa ghen thua th·∫Øm li·ªÖu h·ªùn k√©m xanh\" d·ª± b√°o ƒëi·ªÅu g√¨?", options: ["T√†i nƒÉng thi√™n b·∫©m", "S·ªë ph·∫≠n y√™n b√¨nh", "S·ªë ph·∫≠n s√≥ng gi√≥, b·ªã ƒë·ªë k·ªµ", "S·ª©c kh·ªèe y·∫øu"], correctIndex: 2, explanation: "Thuy·∫øt 'T√†i m·ªánh t∆∞∆°ng ƒë·ªë' c·ªßa Nguy·ªÖn Du.", citation: "Truy·ªán Ki·ªÅu"},
                 {content: "\"ƒê√™m m∆° H√† N·ªôi d√°ng ki·ªÅu th∆°m\" th·ªÉ hi·ªán v·∫ª ƒë·∫πp n√†o?", options: ["H√†o hoa, l√£ng m·∫°n", "Ch√¢n ch·∫•t", "Kh·∫Øc kh·ªï", "Gi·∫£n d·ªã"], correctIndex: 0, explanation: "Ch·∫•t l√£ng m·∫°n, t√¢m h·ªìn m·ªông m∆° c·ªßa l√≠nh T√¢y Ti·∫øn.", citation: "T√¢y Ti·∫øn"},
                 {content: "\"Ph·∫£i bi·∫øt g·∫Øn b√≥ v√† san s·∫ª\" (ƒê·∫•t N∆∞·ªõc) l√† l·ªùi nh·∫Øn nh·ªß v·ªÅ?", options: ["Tr√°ch nhi·ªám c√¥ng d√¢n", "Quy·ªÅn l·ª£i c√° nh√¢n", "C√°ch l√†m gi√†u", "Du l·ªãch"], correctIndex: 0, explanation: "Tr√°ch nhi·ªám c·ªßa c√° nh√¢n ƒë·ªëi v·ªõi c·ªông ƒë·ªìng, ƒë·∫•t n∆∞·ªõc.", citation: "ƒê·∫•t N∆∞·ªõc"},
                 {content: "\"T√¥i mu·ªën bu·ªôc gi√≥ l·∫°i\" th·ªÉ hi·ªán c√°i t√¥i nh∆∞ th·∫ø n√†o?", options: ["Nh√∫t nh√°t", "Ng√¥ng cu·ªìng, kh√°t khao m√£nh li·ªát", "Khi√™m t·ªën", "Bu·ªìn b√£"], correctIndex: 1, explanation: "C√°i t√¥i mu·ªën ƒëo·∫°t quy·ªÅn t·∫°o h√≥a ƒë·ªÉ gi·ªØ m√£i v·∫ª ƒë·∫πp.", citation: "V·ªôi v√†ng"}
            ],
            [LevelType.GRADUATION]: [
                 {content: "\"Tan ƒë∆∞·ª£c gi·ªØa mu√¥n tr√πng s√≥ng b·ªÉ\" (S√≥ng) l√† kh√°t v·ªçng?", options: ["T·ª± t·ª≠", "Tr·ªën tr√°nh", "H√≥a th√¢n v√†o t√¨nh y√™u vƒ©nh c·ª≠u", "Du l·ªãch"], correctIndex: 2, explanation: "Kh√°t v·ªçng b·∫•t t·ª≠ h√≥a t√¨nh y√™u.", citation: "S√≥ng"},
                 {content: "\"S·∫•m c≈©ng b·ªõt b·∫•t ng·ªù / Tr√™n h√†ng c√¢y ƒë·ª©ng tu·ªïi\" ·∫©n d·ª•?", options: ["Thi√™n nhi√™n hi·ªÅn h√≤a", "S·∫•m √≠t ƒëi", "S·ª± ƒëi·ªÅm tƒ©nh c·ªßa ng∆∞·ªùi t·ª´ng tr·∫£i", "C√¢y gi√†"], correctIndex: 2, explanation: "B·∫£n lƒ©nh tr∆∞·ªõc s√≥ng gi√≥ cu·ªôc ƒë·ªùi.", citation: "Sang thu"},
                 {content: "\"L√†n thu th·ªßy n√©t xu√¢n s∆°n\" d√πng b√∫t ph√°p?", options: ["T·∫£ th·ª±c", "∆Ø·ªõc l·ªá t∆∞·ª£ng tr∆∞ng", "Tr√†o ph√∫ng", "Hi·ªán th·ª±c"], correctIndex: 1, explanation: "D√πng thi√™n nhi√™n ƒë·ªÉ g·ª£i t·∫£ v·∫ª ƒë·∫πp con ng∆∞·ªùi (c·ªï ƒëi·ªÉn).", citation: "Truy·ªán Ki·ªÅu"},
                 {content: "\"C√¢u h√°t cƒÉng bu·ªìm c√πng gi√≥ kh∆°i\" th·ªÉ hi·ªán?", options: ["M·ªát m·ªèi", "H√†o h·ª©ng, l√†m ch·ªß thi√™n nhi√™n", "Lo s·ª£", "B·∫Øt bu·ªôc"], correctIndex: 1, explanation: "S·ª©c m·∫°nh c·ªßa con ng∆∞·ªùi h√≤a c√πng s·ª©c m·∫°nh thi√™n nhi√™n.", citation: "ƒêo√†n thuy·ªÅn ƒë√°nh c√°"},
                 {content: "Bi·ªán ph√°p trong \"T√¥i mu·ªën t·∫Øt n·∫Øng... T√¥i mu·ªën bu·ªôc gi√≥\"?", options: ["ƒêi·ªáp ng·ªØ, ƒë·ªông t·ª´ m·∫°nh", "So s√°nh", "Nh√¢n h√≥a", "·∫®n d·ª•"], correctIndex: 0, explanation: "Nh·∫•n m·∫°nh kh√°t v·ªçng m√£nh li·ªát.", citation: "V·ªôi v√†ng"},
                 {content: "\"H·ªìn v·ªÅ S·∫ßm N∆∞a ch·∫≥ng v·ªÅ xu√¥i\" th·ªÉ hi·ªán tinh th·∫ßn?", options: ["Nh·ªõ nh√†", "Quy·∫øt t·ª≠ cho t·ªï qu·ªëc quy·∫øt sinh", "Mu·ªën ƒëi du l·ªãch", "S·ª£ h√£i"], correctIndex: 1, explanation: "Tinh th·∫ßn hi·∫øn d√¢ng tr·ªçn v·∫πn cho l√Ω t∆∞·ªüng c√°ch m·∫°ng.", citation: "T√¢y Ti·∫øn"},
                 {content: "\"Em kh√¥ng bi·∫øt s√≥ng b·∫Øt ƒë·∫ßu t·ª´ ƒë√¢u\" g·ª£i l√™n?", options: ["S·ª± thi·∫øu hi·ªÉu bi·∫øt", "S·ª± b√≠ ·∫©n, di·ªáu k·ª≥ c·ªßa t√¨nh y√™u", "S√≥ng th·∫ßn", "ƒê·ªãa l√Ω bi·ªÉn"], correctIndex: 1, explanation: "C·∫Øt nghƒ©a t√¨nh y√™u l√† ƒëi·ªÅu kh√¥ng th·ªÉ l√Ω gi·∫£i b·∫±ng logic.", citation: "S√≥ng"},
                 {content: "\"ƒê·∫ßu l√≤ng hai ·∫£ t·ªë nga\" - \"T·ªë nga\" ch·ªâ ai?", options: ["Ng∆∞·ªùi ƒë·∫πp", "M·∫∑t trƒÉng", "H·∫±ng Nga", "Ng∆∞·ªùi h·∫ßu"], correctIndex: 0, explanation: "T·ª´ H√°n Vi·ªát ch·ªâ ng∆∞·ªùi con g√°i ƒë·∫πp.", citation: "Truy·ªán Ki·ªÅu"},
                 {content: "\"L√≤ng qu√™ d·ª£n d·ª£n v·ªùi con n∆∞·ªõc\" (Tr√†ng Giang) di·ªÖn t·∫£?", options: ["Say s√≥ng", "N·ªói nh·ªõ nh√† da di·∫øt, tri·ªÅn mi√™n", "Vui v·∫ª", "H√°o h·ª©c"], correctIndex: 1, explanation: "N·ªói bu·ªìn, n·ªói nh·ªõ qu√™ h∆∞∆°ng d√¢ng l√™n theo con s√≥ng.", citation: "Tr√†ng Giang"},
                 {content: "\"Th√¥i ƒë√£ h·∫øt r·ªìi th·ªùi b√≠m t√≥c tr·∫Øng ng·ªùi\" (Chi·∫øc l√° ƒë·∫ßu ti√™n) g·ª£i?", options: ["S·ª± h·ªëi ti·∫øc th·ªùi gian, tu·ªïi tr·∫ª", "Mu·ªën c·∫Øt t√≥c", "Th√≠ch t√≥c ƒëen", "M·∫•t k·∫πp t√≥c"], correctIndex: 0, explanation: "S·ª± ti·∫øc nu·ªëi ng·∫≠m ng√πi v·ªÅ th·ªùi h·ªçc tr√≤ trong s√°ng ƒë√£ qua.", citation: "Chi·∫øc l√° ƒë·∫ßu ti√™n"}
            ]
        };

        // --- COMPONENTS ---

        const Layout = ({ children, isMuted, onToggleMute, xp, userName }) => {
            const [isScrolled, setIsScrolled] = React.useState(false);
            const mainRef = React.useRef(null);
            
            React.useEffect(() => {
                const handleScroll = () => { if (mainRef.current) setIsScrolled(mainRef.current.scrollTop > 10); };
                const el = mainRef.current;
                if (el) el.addEventListener('scroll', handleScroll);
                return () => el && el.removeEventListener('scroll', handleScroll);
            }, []);

            return (
                <div className="relative flex flex-col h-[100dvh] w-full font-sans overflow-hidden">
                    <header className={`flex-none w-full glass-panel shadow-sm p-2 z-50 flex justify-between items-center gap-2 px-3 md:px-6 transition-all duration-500 relative ${isScrolled ? 'bg-white/95 backdrop-blur-xl shadow-md py-1' : 'bg-white/70 py-2'}`}>
                        <div className="flex-1 min-w-0 flex flex-col justify-center">
                            <h2 className={`text-[9px] md:text-[11px] font-bold text-slate-500 tracking-wide uppercase truncate transition-all ${isScrolled ? 'h-0 opacity-0 mb-0' : 'h-auto opacity-100 mb-0.5'}`}>C√îNG TY TNHH T∆Ø V·∫§N V√Ä PH√ÅT TRI·ªÇN GI√ÅO D·ª§C INNEDU</h2>
                            <h1 className="text-[10px] md:text-[14px] font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-700 to-indigo-700 serif-font leading-tight line-clamp-2 md:line-clamp-none">CU·ªòC THI S√ÅNG T·∫†O S·∫¢N PH·∫®M GI√ÅO D·ª§C TR√äN N·ªÄN T·∫¢NG ROBOKI AI</h1>
                        </div>
                        <div className="flex items-center gap-2 md:gap-4 flex-shrink-0">
                            {userName && (
                                <div className="flex items-center gap-1.5 bg-gradient-to-br from-yellow-50 to-amber-100 border border-yellow-300 rounded-full pl-1 pr-3 py-0.5 shadow-sm">
                                    <div className="bg-gradient-to-br from-yellow-400 to-orange-500 text-white rounded-full p-1 shadow-inner text-[10px]">‚òÖ</div>
                                    <span className="text-sm md:text-lg font-black text-amber-700 tabular-nums">{xp}</span>
                                </div>
                            )}
                            <button onClick={onToggleMute} className="p-2 rounded-full bg-white/50 border border-slate-200">
                                {isMuted ? "üîá" : "üîä"}
                            </button>
                            <img src={ROBOKI_LOGO_URL} alt="Logo" className={`w-8 h-8 md:w-12 md:h-12 rounded-full border border-white shadow-md bg-white object-cover ${isScrolled ? 'animate-[spin_12s_linear_infinite]' : ''}`} />
                        </div>
                    </header>
                    <main ref={mainRef} className="flex-1 w-full overflow-y-auto overflow-x-hidden relative scroll-smooth">
                        <div className="min-h-full w-full max-w-5xl mx-auto flex flex-col items-center justify-center p-3 pb-20 md:p-6">{children}</div>
                    </main>
                    <footer className="hidden md:block absolute bottom-1 text-center w-full px-4 mix-blend-multiply pointer-events-none">
                        <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest opacity-60">ƒê·∫∑ng Th·ªã B√≠ch H√†i - THPT T·ªãnh Bi√™n, An Giang</p>
                    </footer>
                </div>
            );
        };

        const IntroScreen = ({ onStart }) => {
            const [data, setData] = React.useState({name: '', className: '', school: ''});
            const handleSubmit = (e) => {
                e.preventDefault();
                const audio = new Audio(SOUNDS.CORRECT); audio.volume=0.5; audio.play().catch(()=>{});
                onStart(data);
            };
            return (
                <div className="glass-panel rounded-[2rem] shadow-2xl p-8 md:p-12 animate-fade-in mx-auto max-w-md w-full relative overflow-hidden border border-white/60">
                    <div className="flex flex-col items-center mb-8">
                        <img src={ROBOKI_LOGO_URL} className="w-28 h-28 mb-6 rounded-full shadow-2xl border-4 border-white object-cover animate-bounce-slow" />
                        <h1 className="text-3xl font-black text-slate-800 text-center uppercase mb-2 serif-font">Th·ª≠ T√†i <span className="text-blue-600">VƒÉn H·ªçc</span></h1>
                        <p className="text-center text-slate-600 font-medium mb-3">C√πng Roboki AI chinh ph·ª•c ƒë·ªânh cao tri th·ª©c!</p>
                        <div className="flex gap-3 bg-white/60 px-4 py-1.5 rounded-full shadow-sm text-xs font-bold text-slate-600"><span>üìö 3 C·∫•p ƒë·ªô</span><span>|</span><span>‚ö° 5 C√¢u h·ªèi/V√≤ng</span></div>
                    </div>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <input required placeholder="H·ªç v√† t√™n..." className="w-full px-4 py-3 rounded-xl border border-slate-300 font-bold" value={data.name} onChange={e=>setData({...data, name: e.target.value})} />
                        <div className="grid grid-cols-2 gap-4">
                            <input required placeholder="L·ªõp (VD: 12A1)" className="w-full px-4 py-3 rounded-xl border border-slate-300 font-bold" value={data.className} onChange={e=>setData({...data, className: e.target.value})} />
                            <input required placeholder="Tr∆∞·ªùng..." className="w-full px-4 py-3 rounded-xl border border-slate-300 font-bold" value={data.school} onChange={e=>setData({...data, school: e.target.value})} />
                        </div>
                        <button type="submit" className="w-full mt-4 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold text-lg rounded-2xl shadow-lg hover:scale-[1.02] transition-all">B·∫ÆT ƒê·∫¶U</button>
                    </form>
                </div>
            );
        };

        const RoadmapScreen = ({ user, xp, completionCount, onContinue }) => {
            const renderLevel = (lvl, locked, next, titleOverride) => {
                const info = LEVEL_INFO[lvl];
                let cls = "p-4 rounded-2xl border-2 transition-all flex flex-col gap-2 ";
                cls += locked ? "bg-slate-50 border-slate-200 opacity-60 grayscale" : next ? "bg-white border-blue-400 shadow-lg scale-105 ring-4 ring-blue-100 z-10" : "bg-white border-slate-200 shadow-sm";
                if(!locked && lvl === LevelType.SPECIAL) cls = "p-4 rounded-2xl border-2 border-yellow-400 bg-yellow-50 shadow-lg scale-105 z-10 animate-pulse-slow";
                if(!locked && lvl === LevelType.GRADUATION) cls = "p-4 rounded-2xl border-2 border-cyan-400 bg-cyan-50 shadow-lg scale-105 z-10";

                return (
                    <div className={cls} onClick={!locked ? onContinue : undefined}>
                        <div className="flex justify-between items-start">
                            <div className="w-10 h-10 rounded-full flex items-center justify-center text-xl border bg-white">{info.icon}</div>
                            {locked ? <span className="text-xs font-bold bg-slate-200 text-slate-500 px-2 py-1 rounded">Kh√≥a</span> : next && <span className="text-xs font-bold bg-blue-100 text-blue-700 px-2 py-1 rounded">Ti·∫øp theo</span>}
                        </div>
                        <div>
                            <h3 className="font-bold text-sm md:text-base text-slate-800">{titleOverride || info.title.split(': ')[1] || info.title}</h3>
                            <p className="text-[10px] text-slate-500 line-clamp-2 mt-1">{info.desc}</p>
                        </div>
                        <div className="mt-auto pt-2 flex gap-1">
                            {[1,2,3,4,5].map(i => <div key={i} className={`h-1.5 flex-1 rounded-full ${locked?'bg-slate-200':next?'bg-blue-200':'bg-green-200'}`}></div>)}
                        </div>
                    </div>
                );
            };
            return (
                <div className="w-full max-w-4xl mx-auto flex flex-col h-full animate-fade-in pb-12">
                    <div className="text-center mb-6">
                        <h2 className="text-2xl md:text-4xl font-black text-slate-800 uppercase serif-font mb-2">L·ªô Tr√¨nh Chinh Ph·ª•c</h2>
                        <div className="flex flex-col md:flex-row items-center justify-center gap-2 font-medium text-slate-600">
                             <p>Xin ch√†o, <span className="text-blue-700 font-bold">{user.name}</span>!</p>
                             <div className="flex items-center gap-1 bg-amber-100 px-3 py-1 rounded-full border border-amber-200 text-amber-800 font-black">‚òÖ {xp} XP</div>
                        </div>
                    </div>
                    <div className="flex-1 overflow-y-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div onClick={onContinue}>{renderLevel(LevelType.LEVEL_1, false, true)}</div>
                        <div className="opacity-70">{renderLevel(LevelType.LEVEL_2, true, false)}</div>
                        <div className="opacity-70 relative">
                             {renderLevel(LevelType.LEVEL_3, true, false)}
                             {completionCount < 9 && completionCount >= 7 && <div className="absolute -top-4 left-1/2 -translate-x-1/2 bg-yellow-100 text-yellow-800 text-xs p-1 rounded border border-yellow-300">S·∫Øp m·ªü kh√≥a Nh√¢n T√†i!</div>}
                        </div>
                    </div>
                    <div className="mt-8 flex justify-center">
                        <button onClick={onContinue} className="px-10 py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold text-xl rounded-full shadow-xl animate-pulse hover:animate-none transform hover:scale-105 transition-all">B·∫ÆT ƒê·∫¶U CHINH PH·ª§C</button>
                    </div>
                </div>
            );
        };

        const LevelIntroScreen = ({ level, onStart }) => {
            const info = LEVEL_INFO[level];
            const generateHTML = () => {
                const qs = QUESTION_POOL[level] || []; // Use full pool for offline download
                let html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>B√†i t·∫≠p Offline ${level}</title></head><body><h1>${info.title}</h1>`;
                qs.slice(0, 10).forEach((q,i) => { // Limit to 10 for download
                    html += `<div style="margin-bottom:20px; border:1px solid #ccc; padding:10px;"><h3>C√¢u ${i+1}: ${q.content}</h3><ul>${q.options.map(o=>`<li>${o}</li>`).join('')}</ul><p><i>ƒê√°p √°n ƒë√∫ng: ${String.fromCharCode(65+q.correctIndex)}</i></p><p>${q.explanation}</p></div>`;
                });
                html += "</body></html>";
                const blob = new Blob([html], {type: 'text/html'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = url; a.download = `BaiTap_${level}.html`; a.click();
            };
            return (
                <div className="w-full max-w-lg mx-auto p-8 rounded-[2rem] shadow-2xl animate-scale-in border-4 border-blue-200 bg-white text-center">
                    <div className="w-24 h-24 mb-6 rounded-full flex items-center justify-center text-6xl shadow-inner bg-blue-100 mx-auto">{info.icon}</div>
                    <h2 className="text-3xl font-black uppercase text-blue-900 serif-font mb-3">{info.title}</h2>
                    <p className="text-slate-600 font-medium text-lg mb-8">{info.desc}</p>
                    <div className="mb-6 bg-slate-100 px-4 py-2 rounded-lg inline-block"><span className="font-bold text-slate-500">M·ª•c ti√™u:</span> <span className="font-black text-blue-700">5/5 C√¢u</span></div>
                    <button onClick={onStart} className="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold text-xl rounded-2xl shadow-lg hover:scale-105 transition-all mb-4">B·∫ÆT ƒê·∫¶U</button>
                    <button onClick={generateHTML} className="text-sm text-slate-500 underline hover:text-blue-600">T·∫£i ƒë·ªÅ Offline (HTML)</button>
                </div>
            );
        };

        const QuizScreen = ({ level, questions, questionIndex, onAnswer, onNext, isMuted }) => {
            const q = questions[questionIndex];
            const [selected, setSelected] = React.useState(null);
            const [answered, setAnswered] = React.useState(false);
            const [isCorrect, setIsCorrect] = React.useState(false);
            const scrollRef = React.useRef(null);

            React.useEffect(() => { setSelected(null); setAnswered(false); setIsCorrect(false); }, [q]);
            
            // Auto scroll to feedback
            React.useEffect(() => {
                if(answered && scrollRef.current) {
                    setTimeout(() => scrollRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' }), 100);
                }
            }, [answered]);

            const handleOpt = (idx) => {
                if(answered) return;
                const correct = idx === q.correctIndex;
                setSelected(idx); setAnswered(true); setIsCorrect(correct);
                onAnswer(correct);
                if(!isMuted) {
                    const audio = new Audio(correct ? SOUNDS.CORRECT : SOUNDS.WRONG);
                    audio.volume = correct ? 1.0 : 0.8; 
                    audio.play().catch(()=>{});
                    if(correct) {
                        setTimeout(() => { new Audio(SOUNDS.CORRECT_LAYER).play().catch(()=>{}); }, 100);
                        confetti({ particleCount: 50, spread: 70, origin: { y: 0.6 } });
                    } else {
                         setTimeout(() => { new Audio(SOUNDS.WRONG_LAYER).play().catch(()=>{}); }, 100);
                    }
                }
            };

            const themeColor = level === LevelType.LEVEL_3 ? "purple" : level === LevelType.SPECIAL ? "orange" : level === LevelType.GRADUATION ? "cyan" : "blue";

            return (
                <div className="w-full max-w-4xl mx-auto flex flex-col gap-2 pb-16">
                     <div className={`glass-panel px-4 py-2 rounded-xl shadow-sm border border-${themeColor}-200 flex justify-between items-center`}>
                        <span className={`font-black uppercase text-sm text-${themeColor}-800`}>{level}</span>
                        <div className="flex-1 mx-4 h-2 bg-slate-200 rounded-full"><div className={`h-full rounded-full bg-${themeColor}-500 transition-all`} style={{width: `${(questionIndex+1)/questions.length*100}%`}}></div></div>
                        <span className="font-bold text-xs bg-white px-2 py-1 rounded-full">{questionIndex+1}/{questions.length}</span>
                     </div>
                     
                     <div className={`bg-white rounded-lg p-4 border-b-4 border-${themeColor}-100 shadow-md min-h-[100px] flex items-center justify-center relative`}>
                        <h2 className="text-base md:text-2xl font-bold text-slate-800 text-center serif-font">{q.content}</h2>
                     </div>

                     <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                        {q.options.map((opt, i) => {
                            let cls = "relative p-3 rounded-lg text-sm md:text-base font-medium transition-all shadow-sm min-h-[50px] flex items-center justify-center text-center border border-b-2 ";
                            if(answered) {
                                cls += i===q.correctIndex ? "bg-green-50 border-green-500 text-green-800" : i===selected ? "bg-red-50 border-red-500 text-red-800" : "bg-slate-50 border-slate-200 opacity-50";
                            } else {
                                cls += `bg-white border-${themeColor}-100 hover:border-${themeColor}-400 hover:shadow-md cursor-pointer active:scale-95`;
                            }
                            return (
                                <button key={i} onClick={()=>handleOpt(i)} disabled={answered} className={cls}>
                                    {opt}
                                    <span className="absolute top-1 left-2 text-[10px] text-slate-400 font-bold">{String.fromCharCode(65+i)}</span>
                                </button>
                            );
                        })}
                     </div>

                     {answered && (
                         <div ref={scrollRef} className={`animate-slide-up rounded-xl p-4 border-l-4 ${isCorrect ? 'bg-green-50 border-green-500' : 'bg-red-50 border-red-500'} shadow-lg mb-4`}>
                             <div className="flex items-center gap-3 mb-2">
                                 <div className="text-3xl">{isCorrect ? 'üå∏' : 'ü§°'}</div>
                                 <h3 className={`font-black uppercase ${isCorrect ? 'text-green-700' : 'text-red-700'}`}>{isCorrect ? "Ch√≠nh x√°c!" : "Sai r·ªìi!"}</h3>
                             </div>
                             <p className="text-slate-800 text-sm md:text-base font-medium mb-3">{q.explanation}</p>
                             {q.citation && <div className="text-xs text-slate-500 italic border-t border-slate-200 pt-2">üìñ Ngu·ªìn: {q.citation}</div>}
                             <button onClick={onNext} className={`w-full py-3 mt-2 bg-${themeColor}-600 text-white font-bold rounded-xl shadow-md hover:scale-105 transition-all`}>K·∫æ TI·∫æP</button>
                         </div>
                     )}
                </div>
            );
        };

        const LevelResultScreen = ({ score, total, level, onNext, onRetry, isMuted }) => {
            const isPass = score === total;
            React.useEffect(() => { 
                if(isPass && !isMuted) { new Audio(SOUNDS.VICTORY_LEVEL).play().catch(()=>{}); }
            }, [isPass]);
            return (
                <div className="glass-panel rounded-[2rem] shadow-2xl p-8 max-w-lg w-full text-center mx-auto border border-white/60 animate-scale-in">
                     <div className="text-8xl mb-4 animate-bounce">{isPass ? 'üèÜ' : 'üí™'}</div>
                     <h2 className={`text-4xl font-black mb-2 uppercase ${isPass ? 'text-green-600' : 'text-orange-500'}`}>{isPass ? 'HO√ÄN TH√ÄNH!' : 'C·ªê G·∫ÆNG L√äN!'}</h2>
                     <p className="text-xl font-bold text-slate-700 mb-6">{score}/{total} c√¢u</p>
                     {isPass ? (
                         <button onClick={onNext} className="w-full py-4 bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-bold rounded-2xl shadow-lg hover:scale-105 transition-all">TI·∫æP T·ª§C</button>
                     ) : (
                         <button onClick={onRetry} className="w-full py-4 bg-slate-700 text-white font-bold rounded-2xl shadow-lg hover:bg-slate-600 transition-all">L√ÄM L·∫†I B√ÄI T·∫¨P</button>
                     )}
                </div>
            );
        };

        const CertificateScreen = ({ user, rank, xp, completionCount, onRestart, isMuted }) => {
            React.useEffect(() => {
                if(!isMuted) new Audio(SOUNDS.CERTIFICATE_SOUND).play().catch(()=>{});
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#FFD700'] });
            }, []);
            
            // Logic: Chi·∫øn th·∫Øng l·∫ßn 1, 2, 3...
            let title = "CHI·∫æN TH·∫ÆNG ƒê·∫¶U TI√äN";
            if(completionCount>=9) title = "CHI·∫æN TH·∫ÆNG L·∫¶N 4 - HUY CH∆Ø∆†NG KIM C∆Ø∆†NG";
            else if(completionCount>=6) title = "CHI·∫æN TH·∫ÆNG L·∫¶N 3 - NH√Ä V√î ƒê·ªäCH";
            else if(completionCount>=3) title = "CHI·∫æN TH·∫ÆNG L·∫¶N 2 - CHU·ªñI CHI·∫æN TH·∫ÆNG";
            
            // Default fallback if logic is 0 (shouldn't happen on cert screen)
            if(completionCount === 0) title = "CH·ª®NG NH·∫¨N THAM GIA";

            return (
                <div className="max-w-2xl w-full mx-auto animate-fade-in pb-20">
                    <div className="relative bg-[#fffdf5] rounded-xl shadow-2xl p-2 overflow-hidden border-8 border-double border-[#b48d52]">
                        {/* Top Right Logo */}
                        <div className="absolute top-5 right-5 z-20 flex flex-col items-center">
                             <img src={ROBOKI_LOGO_URL} className="w-12 h-12 rounded-full border-2 border-[#b48d52] bg-white object-cover" />
                             <span className="text-[10px] font-black text-[#b48d52] mt-1">ROBOKI AI</span>
                        </div>

                        <div className="border-2 border-[#b48d52]/30 p-8 flex flex-col items-center text-center mt-4">
                            <h1 className="text-3xl font-black text-[#85603f] uppercase serif-font mb-2">TH·ª¨ T√ÄI VƒÇN H·ªåC</h1>
                            <p className="text-[#85603f] italic mb-6">Trao t·∫∑ng cho</p>
                            <h2 className="text-5xl font-black text-[#d32f2f] serif-font mb-4">{user.name}</h2>
                            <p className="text-xl font-bold text-slate-700 mb-6">{user.className} - {user.school}</p>
                            
                            <h3 className="text-2xl font-black text-[#1e3a8a] uppercase mb-6">{title}</h3>
                            
                            <div className="flex gap-4 mb-8">
                                <div className="bg-yellow-100 border border-yellow-400 px-4 py-2 rounded-xl text-center"><div className="text-xs font-bold text-yellow-800 uppercase">X·∫øp lo·∫°i</div><div className="text-2xl font-black text-red-700">{rank}</div></div>
                                <div className="bg-blue-100 border border-blue-400 px-4 py-2 rounded-xl text-center"><div className="text-xs font-bold text-blue-800 uppercase">ƒêi·ªÉm XP</div><div className="text-2xl font-black text-blue-900">{xp}</div></div>
                            </div>
                            
                            <div className="flex justify-between w-full text-xs text-[#85603f] mt-4 border-t border-[#b48d52]/50 pt-2 items-end">
                                {/* Bottom Left: Logo + Auto Confirm */}
                                <div className="flex flex-col items-center">
                                     <img src="https://github.com/bichhai85-lab/Logo/blob/main/logo%20tro%20choi.jpg?raw=true" className="w-16 h-16 rounded-full border-2 border-[#b48d52] object-cover shadow-sm mb-2" />
                                     <div className="border-t border-[#b48d52] pt-1 w-full text-center font-bold uppercase tracking-wider text-[10px]">X√°c nh·∫≠n t·ª± ƒë·ªông</div>
                                </div>
                                <div className="text-center"><b>Gi√°o vi√™n ph·ª• tr√°ch</b><br/>ƒê·∫∑ng Th·ªã B√≠ch H√†i</div>
                            </div>
                        </div>
                    </div>
                    <div className="mt-6 text-center">
                        <button onClick={onRestart} className="px-8 py-3 bg-blue-600 text-white font-bold rounded-xl shadow-lg hover:scale-105 transition-all">L√†m l·∫°i ƒë·ªÉ n√¢ng h·∫°ng & T√≠ch ƒëi·ªÉm</button>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [gameState, setGameState] = React.useState({ screen: 'INTRO', level: LevelType.LEVEL_1, questions: [], qIndex: 0, score: 0, user: {}, xp: 0 });
            const [completionCount, setCompletionCount] = React.useState(parseInt(localStorage.getItem('roboki_completion_count')||0));
            const [isMuted, setIsMuted] = React.useState(false);

            // SHUFFLE & RANDOMIZATION LOGIC
            const getShuffledQuestions = (lvl) => {
                // 1. Get full pool
                const pool = QUESTION_POOL[lvl] || QUESTION_POOL[LevelType.LEVEL_1];
                
                // 2. Randomly select 5 questions
                let selectedQuestions = [...pool].sort(() => Math.random() - 0.5).slice(0, 5);

                // 3. For each question, shuffle the options and update correctIndex
                return selectedQuestions.map((q, idx) => {
                    const originalCorrectAnswer = q.options[q.correctIndex];
                    // Create pairs of [option, index] to shuffle, but since options are strings, just shuffle strings
                    // Warning: If duplicates exist in options, index might be ambiguous. Assuming unique options.
                    const shuffledOptions = [...q.options].sort(() => Math.random() - 0.5);
                    const newCorrectIndex = shuffledOptions.indexOf(originalCorrectAnswer);
                    
                    return {
                        ...q,
                        options: shuffledOptions,
                        correctIndex: newCorrectIndex,
                        id: `${lvl}-${Date.now()}-${idx}` // Unique ID
                    };
                });
            };

            const loadLevel = async (lvl) => {
                setGameState(prev => ({ ...prev, screen: 'LOADING', level: lvl, qIndex: 0, score: 0, questions: [] }));
                
                // Simulate loading delay for UX
                setTimeout(() => {
                    const randomizedQuestions = getShuffledQuestions(lvl);
                    setGameState(prev => ({ ...prev, questions: randomizedQuestions, screen: 'LEVEL_INTRO' }));
                }, 1000);
            };

            const handleAnswer = (correct) => { if(correct) setGameState(p => ({...p, score: p.score+1, xp: p.xp+10})); };
            const handleNextQ = () => {
                if(gameState.qIndex < gameState.questions.length-1) setGameState(p => ({...p, qIndex: p.qIndex+1}));
                else setGameState(p => ({...p, screen: 'LEVEL_RESULT'}));
            };
            const handleNextStage = () => {
                const { level } = gameState;
                if(level === LevelType.LEVEL_1) loadLevel(LevelType.LEVEL_2);
                else if(level === LevelType.LEVEL_2) loadLevel(LevelType.LEVEL_3);
                else if(level === LevelType.LEVEL_3) {
                    const newCount = completionCount + 1;
                    setCompletionCount(newCount);
                    localStorage.setItem('roboki_completion_count', newCount);
                    setGameState(p => ({...p, screen: 'CERTIFICATE'}));
                } else if (level === LevelType.SPECIAL) loadLevel(LevelType.GRADUATION);
                else if (level === LevelType.GRADUATION) setGameState(p => ({...p, screen: 'CERTIFICATE'}));
            };

            const getRank = () => {
                if(completionCount>=9) return CertificateRank.XUAT_SAC;
                if(completionCount>=6) return CertificateRank.GIOI;
                if(completionCount>=3) return CertificateRank.KHA;
                return CertificateRank.DAT;
            };

            return (
                <Layout isMuted={isMuted} onToggleMute={()=>setIsMuted(!isMuted)} xp={gameState.xp} userName={gameState.user.name}>
                    {gameState.screen === 'INTRO' && <IntroScreen onStart={(u) => setGameState(p=>({...p, user: u, screen: 'ROADMAP'}))} />}
                    {gameState.screen === 'ROADMAP' && <RoadmapScreen user={gameState.user} xp={gameState.xp} completionCount={completionCount} onContinue={()=>loadLevel(LevelType.LEVEL_1)} />}
                    {gameState.screen === 'LOADING' && <div className="text-center mt-20 text-blue-600 font-black animate-pulse text-2xl">ƒêang t·∫£i d·ªØ li·ªáu...</div>}
                    {gameState.screen === 'LEVEL_INTRO' && <LevelIntroScreen level={gameState.level} onStart={()=>setGameState(p=>({...p, screen: 'PLAYING'}))} />}
                    {gameState.screen === 'PLAYING' && <QuizScreen level={gameState.level} questions={gameState.questions} questionIndex={gameState.qIndex} onAnswer={handleAnswer} onNext={handleNextQ} isMuted={isMuted} />}
                    {gameState.screen === 'LEVEL_RESULT' && <LevelResultScreen score={gameState.score} total={gameState.questions.length} level={gameState.level} onNext={handleNextStage} onRetry={()=>loadLevel(gameState.level)} isMuted={isMuted} />}
                    {gameState.screen === 'CERTIFICATE' && <CertificateScreen user={gameState.user} rank={getRank()} xp={gameState.xp} completionCount={completionCount} onRestart={()=>loadLevel(LevelType.LEVEL_1)} isMuted={isMuted} />}
                </Layout>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
